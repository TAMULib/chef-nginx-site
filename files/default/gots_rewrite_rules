#if the file exists as a static file serve it
# directly without running all
# the other rewite tests on it

if (-f $request_filename) {
	break;
}

#if file does not exist.  Ie running thru Cake

if (!-f $request_filename) {
	set $test P;
}

#if not image files, css, etc
	if ($request_filename !~* \.(gif|jpg|js|css|png)$ ) {
set $test  "${test}C";
}

if ($test = PC){
	rewrite ^/stepbystep/(.*)$ /stepbystep/app/webroot/index.php?url=$1 last;
	break;
}

location ~ ^/stepbystep/img/(.*)$
{
	rewrite ^/stepbystep/(.*)$ /stepbystep/app/webroot/$1 last;
	break;
}

location ~ ^/stepbystep/css/(.*)\.css$
{
	rewrite ^/stepbystep/(.*)$ /stepbystep/app/webroot/$1 last;
	break;
}

location ~ ^/stepbystep/js/(.*)$
{
	rewrite ^/stepbystep/(.*)$ /stepbystep/app/webroot/$1 last;
	break;
}

location ~ ^/stepbystep/TinyMCE/js/tiny_mce/(.*)$
{
	rewrite ^/stepbystep/(.*)$ /stepbystep/app/Plugin/$1 last;
	break;
}

location ~ ^/stepbystep/uploads/images/(.*)$
{
	rewrite ^/stepbystep/uploads/images/(.*)$ /stepbystep/app/webroot/uploads/images/$1 last;
	break;
}